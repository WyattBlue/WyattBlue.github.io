<!doctype html>
<html>
<head>
<style>
	body {
		background-color:#EEE;
	}
	div {
		position:absolute;
	}
	.inner {
		background-color:#C94;
		border-radius:5px;
		font-family:sans-serif;
		padding-left:10px;
		padding-right:10px;
		cursor:text;
		min-width: 200px;
	}
	.a-header{
		background-color:#D11;
		border-radius:30px;
		padding:15px;
		width:1px;
		cursor:move;
		position: relative; 
		left: 50%;
		transform: translateX(-50%);
		top:-10px;

	}
	h1 {
		font-size:35px;
		font-weight:bold;
		margin:0px;
		margin-bottom:8px;
	}
	p {
		font-size:20px;
		margin-bottom:5px;
		margin-top:4px;
	}

	ul {
		position:absolute;
		font-family:sans-serif;
		font-size:22px;
		font-weight:bold;
		color:#444;
		list-style:none;
		background-color:white;
		color:grey;
		border: 1px solid grey;
		display: none;
		white-space: nowrap;
		padding:0;
	}
	#custom-menu li {
		padding: 8px 12px;
		cursor: pointer;
	}	

	#custom-menu li:hover {
		background-color: #DEF;
	}

	.show {
		display:block;
	}

	.hide {
		display:none;
	}
</style>
</head>
<body>

<ul id='custom-menu'>
  <li>Create New</li>
  <li>Load</li>
  <li>Delete Selected</li>
</ul>

<script>
debugger;
let allNotes = [];
try {
	let cookieValue = read_cookie('note');
	if(cookieValue != '' || cookieValue != undefined){
		allNotes = cookieValue;
		console.log(cookieValue);
	}
	else {
		allNotes.push(new note('title','body',200,200));
	}
}
catch(e){
	allNotes.push(new note('title','body',200,200));
}
let x;
let y;
let rightClick = 0;
let leftClick = 0;
let menu = 0;
let dragging = 0;

document.addEventListener('contextmenu', event => event.preventDefault());

//constructor
function note(t,b,x,y){
	this.title = t;
	this.body = b;
	this.x = x;
	this.y = y;
}

!function main(){
	if(dragging == 0){
		clear(document.getElementsByTagName('div'));
		for(let i = 0;i < allNotes.length;i++){
			htmlDiv = document.createElement('div');
			htmlDiv.id=i; 
			htmlDiv.innerHTML = '<div class="inner"><div class="a-header" id="'+i+'header"></div><h1 contentEditable="true" >'+allNotes[i].title+'</h1><p contentEditable="true" >'+allNotes[i].body+'</p></div>';
			document.body.appendChild(htmlDiv);
			let offX = htmlDiv.offsetWidth;
			let offY = htmlDiv.offsetHeight;
			htmlDiv.style.left = (allNotes[i].x-offX/2)+'px';
			htmlDiv.style.top = (allNotes[i].y-offY/2)+'px';
			dragElement(htmlDiv);
		}
	} else {
		for(let i = 0;i< allNotes.length;i++){
			try {
			allNotes[i].title = document.getElementById(i+'').getElementsByTagName('h1')[0].innerText;
			allNotes[i].body = document.getElementById(i+'').getElementsByTagName('p')[0].innerText;
			}
			catch(e){}
		}
	}

	bake_cookie('note',allNotes);

	if(menu){
		document.getElementById('custom-menu').className="show";
	} else {
		document.getElementById('custom-menu').className="hide";
	}

	setTimeout(main,30);
}();

onmousemove = function(e){
	x = e.clientX;
	y = e.clientY;
}

onmousedown = function(e){
	dragging = 1;
	if(e.which == 3){
		rightClick = 1;
		menu = (menu+1)%2;
		if(menu == 1){
			let menu = document.getElementById('custom-menu');
			menu.style.left = e.clientX + "px";
			menu.style.top = e.clientY + "px";
		}
	}
	if(e.which == 1){
		leftClick = 1;
		let value;
		let block;
		try {
			value = touch().innerHTML;
			block = touch().tagName;
		}
		catch(e){
			value = 'error';
		}
		if(block == 'LI') {
			if(value == 'Create New'){
				allNotes.push(new note('title','about',e.clientX,e.clientY));
			}
			if(value == 'Load'){
				//bake_cookie('note',prompt('load data'));
				rawData = prompt('load data');
				eval('allNotes = '+rawData+';');
			}
		}
		menu = 0;
	}
}
onmouseup = function(e){
	if(e.which == 3)rightClick=0;
	if(e.which == 1)leftClick=0;
	try {
		let asdf = touch().tagName;
		if(asdf == "H1" || asdf == "P"){}else{dragging=0;}
	}
	catch(e){dragging = 0;}
}

function clear(tag){
	let spans = tag;
	let len = spans.length;
	for(let i=len-1; i>=0; i--){
		let item = spans[i];
		item.parentNode.removeChild(item);
	}	
}

function dragElement(elmnt) {
	let moveId = elmnt.id;
	let pos1 = 0, pos2 = 0, pos3 = 0, pos4 = 0;
	if (document.getElementById(elmnt.id + "header")) {
		document.getElementById(elmnt.id + "header").onmousedown = dragMouseDown;
	} else {
		elmnt.onmousedown = dragMouseDown;
	}

	function dragMouseDown(e) {
		e = e || window.event;
		e.preventDefault();
		// get the mouse cursor position at startup:
		pos3 = e.clientX;
		pos4 = e.clientY;
		document.onmouseup = closeDragElement;
		// call a function whenever the cursor moves:
		document.onmousemove = elementDrag;
	}

	function elementDrag(e) {
		e = e || window.event;
		e.preventDefault();
		// calculate the new cursor position:
		pos1 = pos3 - e.clientX;
		pos2 = pos4 - e.clientY;
		pos3 = e.clientX;
		pos4 = e.clientY;
		// set the element's new position:
		elmnt.style.top = (elmnt.offsetTop - pos2) + "px";
		elmnt.style.left = (elmnt.offsetLeft - pos1) + "px";
		allNotes[moveId].y = (elmnt.offsetTop - pos2);
		allNotes[moveId].x = (elmnt.offsetLeft - pos1);
	}

	function closeDragElement() {
		/* stop moving when mouse button is released:*/
		document.onmouseup = null;
		document.onmousemove = null;
	}
}

function touch() {
	let n = document.querySelector(":hover");
	let n2;
	while(n) {
		n2 = n;
		n = n2.querySelector(":hover");
	}
	return n2;
}

function read_cookie(name) {
	var result = document.cookie.match(new RegExp(name + '=([^;]+)'));
	result && (result = JSON.parse(result[1]));
	return result;
}

function bake_cookie(name, value) {
	let print = [name, '=', JSON.stringify(value), '; domain=.', window.location.host.toString(), '; path=/;'].join('');
	document.cookie = print;
}

//note=[{"title":"cut to","body":"jimmy in the classroom, holding the door down","x":511,"y":36},{"title":"teacher","body":"boy, why the fuck were you late to my class?","x":752,"y":35},{"title":"teacher","body":"why would school be canceled? It's not a snow day","x":1472,"y":36},{"title":"jimmy","body":"I thought school was canceled","x":1222,"y":41},{"title":"shot","body":"the zombies chase after him","x":265,"y":56},{"title":"outside","body":"jimmy anime runs into the school","x":21,"y":56},{"title":"","body":"teacher then throws a glass bottle at jimmy","x":996,"y":43},{"title":"jimmy","body":"uhh, the zombie apo-","x":21,"y":214},{"title":"teacher","body":"Shut up and go park your sweet ass next to the classroom bully","x":288,"y":200},{"title":"girl","body":"hey! I was worried you weren't going to come to school today","x":542,"y":203},{"title":"girl","body":"don't worry me like that","x":1006,"y":190},{"title":"jimmy","body":"teacher, i am being bullied, in the IRL","x":1229,"y":195},{"title":"teacher","body":"snitches get stiches","x":1483,"y":213},{"title":"jimmy","body":"we gotta get out of here","x":20,"y":353},{"title":"hippo","body":"bruh, these walls can't hold me","x":273,"y":363},{"title":"cut to","body":"hippo breaking the door with his motocycle. The teacher gets hit","x":538,"y":362},{"title":"teacher","body":"if the zombies get me, you all fail.","x":770,"y":350},{"title":"hippo","body":"bruh, i can't fail this class","x":1004,"y":344},{"title":"girl","body":"you don't go to school here","x":1233,"y":343},{"title":"hippo","body":"oh yeah, then let's just go home","x":1478,"y":344},{"title":"jimmy","body":"wha-why do you have all of this","x":767,"y":506},{"title":"jimmy","body":"how are we supposed to get through all the zombies","x":30,"y":499},{"title":"hippo","body":"bruh, you forget where you is? this public school","x":290,"y":513},{"title":"cut to","body":"lots of guns, some fictional","x":538,"y":550},{"title":"hippo","body":"there are a lot of sickos out there","x":1002,"y":496},{"title":"cut to","body":"jimmy, girl and hippo all beating up the zombies","x":1233,"y":508},{"title":"jimmy","body":"you know, overall, this was actually like, a less stressful day than usual","x":1478,"y":503},{"title":"hippo","body":"i didn't even get stabbed once today","x":30,"y":693},{"title":"girl","body":"and we get to go home early","x":294,"y":692},{"title":"teacher","body":"hey, the zombie apocalypse doesn't dismiss you, I do!","x":548,"y":689},{"title":"teacher","body":"you are all getting super detention - and enough homework to choke a small hippo","x":784,"y":694},{"title":"","body":"slams a knife on the table","x":776,"y":196},{"title":"","body":"a zombie then attacks the teacher","x":1020,"y":698}];]; domain=.; path=/;

</script>
</body>
</html>
